# 用户文档

## 快速开始

### 首次使用

#### 1. 初始化系统管理员

首次启动系统时，需要初始化系统管理员账号：

1. 打开登录页面
2. 点击"初始化平台管理员"按钮
3. 填写以下信息：
   - **用户名**：系统管理员的用户名
   - **手机号**：系统管理员的手机号（全局唯一，用作登录账号）
   - **密码**：系统管理员的密码（至少6个字符）
4. 点击"创建"按钮完成初始化

**注意**：系统管理员账号创建后，初始化按钮将不再显示。

#### 2. 登录系统

1. 在登录页面输入：
   - **手机号**：您的手机号
   - **密码**：您的密码
2. 点击"登录"按钮
3. 系统会自动识别您的身份（系统管理员或租户用户）
4. 登录成功后，系统会根据您的权限自动跳转到相应页面

## 系统管理员使用指南

### 租户管理

#### 创建租户

1. 登录系统后，进入"租户管理"页面
2. 点击"新建租户"按钮
3. 填写租户信息：
   - **租户编码**：租户的唯一编码（必填，不能重复）
   - **租户名称**：租户的名称（必填，不能重复）
   - **租户描述**：租户的描述信息（可选）
4. 点击"创建"按钮完成创建

**说明**：
- 创建租户时，系统会自动创建"租户管理员"角色
- 租户创建后，状态默认为"启用"

#### 管理租户

- **查看租户列表**：在租户管理页面可以查看所有租户
- **查看租户详情**：点击租户名称可以查看租户详情
- **编辑租户**：点击"编辑"按钮可以修改租户信息
- **启用/停用租户**：点击"启用"或"停用"按钮可以切换租户状态
- **删除租户**：点击"删除"按钮可以删除租户（需确认）

### 用户管理

#### 创建用户

1. 进入"用户管理"页面
2. 在租户下拉框中选择要创建用户的租户
3. 点击"新建用户"按钮
4. 填写用户信息：
   - **租户**：选择用户所属租户（必填）
   - **用户名**：用户的用户名（必填，租户内唯一）
   - **手机号**：用户的手机号（必填，全局唯一，用作登录账号）
   - **密码**：用户的密码（必填，至少6个字符）
   - **状态**：用户状态（启用/冻结）
5. 点击"创建"按钮完成创建

#### 管理用户

- **查看用户列表**：在用户管理页面可以查看选定租户的所有用户
- **查看用户详情**：点击用户名可以查看用户详情
- **编辑用户**：点击"编辑"按钮可以修改用户信息
- **启用/冻结用户**：点击"启用"或"冻结"按钮可以切换用户状态
- **删除用户**：点击"删除"按钮可以删除用户（需确认）
- **邀请用户**：点击"邀请用户"按钮可以生成邀请链接（占位实现）
- **批量导入**：点击"批量导入"按钮可以批量导入用户（占位实现）
- **锁定/解锁用户**：可以手动锁定或解锁用户账户（占位实现）

### 角色管理

#### 创建角色

1. 进入"角色管理"页面
2. 点击"新建角色"按钮
3. 填写角色信息：
   - **租户**：选择角色所属租户（系统管理员可以创建系统级角色，选择"无"）
   - **角色名称**：角色的名称（必填，租户内唯一）
   - **角色描述**：角色的描述信息（可选）
   - **状态**：角色状态（启用/停用）
4. 点击"创建"按钮完成创建

#### 管理角色

- **查看角色列表**：在角色管理页面可以查看所有角色
- **查看角色详情**：点击角色名称可以查看角色详情
- **编辑角色**：点击"编辑"按钮可以修改角色信息
- **启用/停用角色**：点击"启用"或"停用"按钮可以切换角色状态
- **删除角色**：点击"删除"按钮可以删除角色（需确认）
- **分配权限**：点击"分配权限"按钮可以为角色分配权限
- **分配用户**：点击"分配用户"按钮可以为角色分配用户

### 权限管理

#### 查看权限

1. 进入"权限管理"页面
2. 可以查看所有权限列表
3. 权限信息包括：
   - 权限编码
   - 权限名称
   - 权限描述
   - 权限类型（菜单/接口/按钮）
   - 所属模块
   - 所属租户（系统级权限显示"无"）

**说明**：权限由系统自动初始化，通常不需要手动创建。

### 配置管理

#### 查看和配置系统设置

1. 进入"配置管理"页面
2. 可以查看和配置以下类型的配置：
   - **模型相关**：LLM、Rerank、Embedding 配置
   - **存储相关**：向量库配置
   - **文档相关**：文档上传、文本切分策略配置
   - **问答相关**：检索参数配置
   - **系统相关**：Langfuse 配置
3. 配置说明：
   - 租户管理员可以看到系统级配置的默认值（作为初始值显示）
   - 修改配置后，会成为租户级配置，覆盖系统级默认值
   - 如果清空配置项，系统会删除租户级配置，回退到系统级默认值
   - 敏感字段（如 API Key）会自动加密存储，显示时仅显示首尾各 4 位

#### 配置可用性探测（占位）

系统提供了配置可用性探测功能（占位实现），可以测试配置是否可用。

**注意**：此功能为占位实现，实际功能待完善。

### 审计日志

#### 查看审计日志

1. 进入"审计日志"页面
2. 可以查看所有 API 请求和响应的记录
3. 支持按以下条件过滤：
   - 时间范围
   - 请求方法
   - 请求路径
   - 用户
   - 租户（仅系统管理员可见）
4. 可以查看详细的日志信息，包括：
   - 请求和响应内容（敏感数据已脱敏）
   - 性能指标（耗时、请求大小、响应大小）
   - 客户端信息（IP 地址、User-Agent）

**说明**：
- 所有 API 请求都会自动记录到审计日志
- 敏感数据会自动脱敏处理
- 如果启用了 Langfuse，请求也会同步记录到 Langfuse

## 租户管理员使用指南

### 用户管理

租户管理员可以管理本租户内的用户，操作方式与系统管理员相同，但只能操作本租户的用户。

**限制**：
- 不能选择其他租户
- 创建用户时，租户字段自动填充且不可修改
- 只能查看和操作本租户的用户

### 角色管理

租户管理员可以管理本租户内的角色，操作方式与系统管理员相同，但只能创建租户级角色。

**限制**：
- 不能创建系统级角色（tenant_id 为 None 的角色）
- 只能查看和操作本租户的角色
- 可以为角色分配系统级权限和本租户的权限

### 权限管理

租户管理员可以查看所有权限（系统级权限和租户级权限），但不能创建或修改权限。

### 配置管理

租户管理员可以管理本租户的配置，操作方式与系统管理员相同，但只能配置租户级配置。

**特点**：
- 可以看到系统级配置的默认值（作为初始值显示）
- 修改后成为租户级配置
- 清空配置项会回退到系统级默认值

### 审计日志

租户管理员可以查看本租户的审计日志，但不能查看其他租户的日志。

## 普通用户使用指南

普通用户根据分配的角色获得相应权限，通常用于文档管理和智能问答等功能。

### 文档管理

#### 文件夹管理

##### 创建文件夹

1. 进入"文档管理"页面
2. 点击"新建文件夹"按钮
3. 填写文件夹信息：
   - **文件夹名称**：文件夹的名称（必填）
   - **父文件夹**：选择父文件夹（可选，不选择则为根目录）
4. 点击"创建"按钮完成创建

**说明**：
- 系统支持根目录+2层子文件夹（共3层）
- 每个用户只能看到自己创建的文件夹
- 文件夹可以用于组织和管理文档

##### 管理文件夹

- **查看文件夹列表**：在文档管理页面可以看到文件夹树形结构
- **查看文件夹详情**：点击文件夹名称可以查看文件夹详情
- **重命名文件夹**：点击文件夹的"重命名"按钮可以修改文件夹名称
- **删除文件夹**：点击文件夹的"删除"按钮可以删除文件夹（需二次确认，输入确认文字）

#### 文档上传

##### 上传文档

1. 进入"文档管理"页面
2. 选择要上传到的文件夹（可选，不选择则上传到根目录）
3. 点击"上传文档"按钮
4. 选择要上传的文件（支持TXT、Markdown、PDF、Word格式）
5. （可选）配置文本切分策略：
   - **切分块大小**：文本切分块大小（默认400）
   - **重叠大小**：文本切分重叠大小（默认100）
   - **切分方法**：选择切分方法（固定长度/段落/关键字）
   - **切分关键字**：当选择"关键字"切分方法时，输入切分关键字
6. 点击"上传"按钮完成上传

**说明**：
- 文件大小限制由系统配置决定（默认50MB）
- 上传后会自动解析和向量化（异步处理）
- 默认使用用户最近使用的配置
- 如果上传同名文件，系统会提示是否创建新版本

##### 同名文件处理

1. 在上传文件前，系统会自动检测同名文件
2. 如果存在同名文件，可以选择：
   - **创建新版本**：创建新版本，旧版本保存到版本历史
   - **使用已有文件**：取消上传，使用已有文件

#### 文档列表

##### 查看文档列表

1. 进入"文档管理"页面
2. 可以按以下条件筛选文档：
   - **文件夹**：选择文件夹查看该文件夹下的文档
   - **状态**：按状态筛选（上传中、解析中、已完成等）
   - **标签**：按标签筛选文档
3. 文档列表显示以下信息：
   - 文件名
   - 文件类型
   - 文件大小
   - 版本号
   - 状态
   - 创建时间

#### 文档详情

##### 查看文档详情

1. 在文档列表中点击文档名称
2. 可以查看文档的详细信息：
   - 基本信息（文件名、类型、大小等）
   - 文档配置（文本切分策略）
   - 文档状态
   - 元数据（标题、摘要、页数）
   - 版本信息

#### 标签管理

##### 为文档添加标签

1. 在文档详情页面点击"添加标签"按钮
2. 可以：
   - 从已有标签中选择（支持搜索）
   - 输入新标签名称创建新标签（自动创建）
3. 点击"确定"完成添加

##### 管理标签

- **查看文档标签**：在文档详情页面可以查看文档的所有标签
- **移除标签**：点击标签的"删除"按钮可以移除标签
- **按标签搜索**：在文档列表页面可以选择标签筛选文档

**说明**：
- 标签属于用户（无全局标签）
- 标签名称限制：20字以内
- 新标签会自动加入标签列表，便于后续使用

#### 版本管理

##### 查看版本历史

1. 在文档详情页面点击"版本历史"按钮
2. 可以查看文档的所有版本历史
3. 版本信息包括：
   - 版本号（V1、V2、V3...）
   - 创建时间
   - 操作者
   - 是否当前版本

##### 删除版本

1. 在版本历史列表中找到要删除的版本
2. 点击"删除"按钮（仅所有者可以删除，不能删除当前版本）
3. 确认删除

**说明**：
- 版本历史不限制数量
- 删除版本不影响当前版本
- 新版本上传后，旧版本的向量数据会自动清理

#### 文档下载

##### 下载文档

1. 在文档列表中点击文档的"下载"按钮
2. 或者 in文档详情页面点击"下载"按钮
3. 浏览器会自动下载文档的原文件

**说明**：下载的是原文件（非Markdown版本）

#### 文档删除和恢复

##### 删除文档

1. 在文档列表中点击文档的"删除"按钮
2. 或者在文档详情页面点击"删除"按钮
3. 确认删除

**说明**：
- 文档会被软删除（进入回收站）
- 向量库索引和chunk数据会同步删除
- 正在处理中的文档不能删除

##### 恢复文档

1. 进入"回收站"页面
2. 找到要恢复的文档
3. 点击"恢复"按钮

**说明**：
- 恢复后的文档需要重新向量化（向量数据已删除）
- 可以从文档列表的"回收站"入口进入

#### 文档配置

##### 查看最近使用的配置

1. 在文档上传页面可以查看用户最近使用的配置
2. 系统会自动使用最近使用的配置作为默认值

**说明**：
- 配置包括：切分块大小、重叠大小、切分方法、切分关键字
- 每次上传文档时使用的配置会自动保存为最近使用的配置
- 可以随时修改配置，修改后的配置会更新为最近使用的配置

### 智能问答（待开发）

智能问答功能正在开发中，将支持：
- 智能问答
- 多轮对话
- 知识库检索
- 对话历史管理

## 常见问题

### Q1: 忘记密码怎么办？

系统提供了密码重置功能（占位实现），您可以通过以下方式重置密码：

1. 在登录页面点击"忘记密码"
2. 输入您的手机号
3. 系统会发送验证码（占位实现，实际需要集成短信/邮件服务）
4. 输入验证码和新密码完成重置

**注意**：密码重置功能目前为占位实现，实际功能待完善。如果无法使用，请联系系统管理员或租户管理员重置密码。

### Q2: 如何切换租户？

系统管理员可以在用户管理页面选择不同的租户进行管理。租户管理员只能管理自己所属的租户。

### Q3: 如何为用户分配角色？

1. 进入"角色管理"页面
2. 找到要分配的角色，点击"分配用户"按钮
3. 在弹窗中选择要分配的用户
4. 点击"确定"完成分配

### Q4: 如何为角色分配权限？

1. 进入"角色管理"页面
2. 找到要分配权限的角色，点击"分配权限"按钮
3. 在弹窗中选择要分配的权限
4. 点击"确定"完成分配

### Q5: 系统管理员和租户管理员有什么区别？

- **系统管理员**：
  - 可以管理所有租户
  - 可以为任意租户创建用户
  - 可以创建系统级角色
  - 不归属于任何租户

- **租户管理员**：
  - 只能管理本租户
  - 只能为本租户创建用户
  - 只能创建租户级角色
  - 归属于特定租户

### Q6: 登录后没有看到某些菜单？

菜单的显示是根据您的权限动态控制的。如果您看不到某个菜单，说明您没有相应的菜单权限。请联系系统管理员或租户管理员为您分配相应的角色和权限。

### Q7: 如何启用 MFA（多因素认证）？

系统提供了 MFA 功能（占位实现），您可以通过以下方式启用：

1. 登录系统后，进入个人设置
2. 找到"多因素认证"选项
3. 点击"启用 MFA"
4. 系统会生成一个密钥和二维码
5. 使用认证应用（如 Google Authenticator）扫描二维码
6. 输入验证码完成启用

**注意**：MFA 功能目前为占位实现，实际功能待完善。

### Q8: 如何查看审计日志？

系统管理员和租户管理员可以查看审计日志：

1. 进入"审计日志"页面
2. 可以查看所有 API 请求和响应的记录
3. 支持按时间、用户、方法、路径等条件过滤
4. 点击"详情"可以查看完整的日志信息

**说明**：审计日志会自动记录所有 API 请求，包括敏感数据的脱敏版本。

### Q9: 支持哪些文件格式？

系统支持以下文件格式：
- TXT（.txt）
- Markdown（.md, .markdown）
- PDF（.pdf）
- Word（.doc, .docx）

**注意**：文件大小限制由系统配置决定（默认50MB）。

### Q10: 文档上传后如何处理？

文档上传后会经历以下处理流程：
1. **上传**：文件上传到服务器
2. **解析**：自动解析为Markdown格式（异步处理）
3. **向量化**：将解析后的内容进行向量化（异步处理）
4. **完成**：文档状态变为"已完成"

**说明**：
- 解析和向量化是异步处理的，不会阻塞上传
- 可以在文档列表中查看文档的处理状态
- 处理失败时，文档状态会显示为"解析失败"或"向量化失败"

### Q11: 如何处理同名文件？

上传同名文件时：
1. 系统会提示是否创建新版本
2. 如果选择"创建新版本"：
   - 创建新版本，版本号自动递增（V1 -> V2 -> V3...）
   - 旧版本保存到版本历史
   - 新版本向量化成功后，旧版本的向量数据会自动清理
3. 如果选择"使用已有文件"：
   - 取消上传，使用已有文件

### Q12: 如何为文档添加标签？

有两种方式为文档添加标签：
1. **从已有标签选择**：在添加标签时，可以从已有标签列表中选择（支持搜索）
2. **创建新标签**：直接输入新标签名称，系统会自动创建新标签

**说明**：
- 标签属于用户（无全局标签）
- 标签名称限制：20字以内
- 新标签会自动加入标签列表，便于后续使用

### Q13: 如何按标签筛选文档？

在文档列表页面：
1. 使用标签筛选器选择要筛选的标签
2. 文档列表会自动筛选出包含该标签的文档

### Q14: 删除文档后可以恢复吗？

可以恢复：
1. 删除的文档会进入"回收站"
2. 可以在"回收站"页面查看已删除的文档
3. 点击"恢复"按钮可以恢复文档

**注意**：
- 恢复后的文档需要重新向量化（向量数据已删除）
- 永久删除的文档无法恢复（目前未实现永久删除功能）

### Q15: 如何查看文档的版本历史？

1. 在文档详情页面点击"版本历史"按钮
2. 可以查看文档的所有版本历史
3. 版本信息包括版本号、创建时间、操作者等

### Q16: 什么是 Langfuse 集成？

Langfuse 是一个 LLM 应用观测和评估平台。如果系统管理员在配置管理中启用了 Langfuse，所有 API 请求会自动记录到 Langfuse，便于分析和优化。

**配置方式**：
1. 系统管理员进入"配置管理"页面
2. 找到"Langfuse"配置项
3. 启用 Langfuse，并配置 Public Key、Secret Key 和服务器地址
4. 配置生效后，所有 API 请求会自动记录到 Langfuse

## 注意事项

### 系统管理相关

1. **手机号唯一性**：手机号在整个系统中必须唯一，不能重复使用
2. **用户名唯一性**：用户名在同一租户内必须唯一
3. **租户编码唯一性**：租户编码在整个系统中必须唯一
4. **租户名称唯一性**：租户名称在整个系统中必须唯一
5. **角色删除**：删除角色前，请确保没有用户使用该角色
6. **租户删除**：删除租户前，请确保租户内没有用户
7. **占位功能**：部分功能标记为"占位实现"，这些功能提供了基本框架，但实际功能待完善
8. **敏感数据保护**：配置中的敏感字段（如 API Key）会自动加密存储，显示时仅显示首尾各 4 位
9. **审计日志**：所有操作都会自动记录到审计日志，请谨慎操作
10. **配置管理**：租户管理员修改配置后，会成为租户级配置；清空配置会回退到系统级默认值

### 文档管理相关

11. **文件格式限制**：系统支持TXT、Markdown、PDF、Word格式，其他格式暂不支持
12. **文件大小限制**：文件大小限制由系统配置决定（默认50MB），超过限制的文件无法上传
13. **文件夹层级限制**：系统支持根目录+2层子文件夹（共3层），超过层级的文件夹无法创建
14. **标签名称限制**：标签名称不能超过20个字符
15. **版本管理**：上传同名文件会自动创建新版本，旧版本的向量数据在新版本向量化成功后会自动清理
16. **文档删除**：删除文档是软删除（进入回收站），向量库索引和chunk数据会同步删除
17. **文档恢复**：从回收站恢复的文档需要重新向量化（向量数据已删除）
18. **文档处理状态**：文档上传后会异步处理（解析和向量化），可以在文档列表中查看处理状态
19. **文档配置**：每次上传文档时可以配置文本切分策略，配置会自动保存为最近使用的配置
20. **文档预览**：文档预览功能正在开发中，目前暂不支持

## 技术支持

如有问题，请联系系统管理员或查看系统日志。
