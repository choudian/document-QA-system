# 用户文档

## 快速开始

### 首次使用

#### 1. 初始化系统管理员

首次启动系统时，需要初始化系统管理员账号：

1. 打开登录页面
2. 点击"初始化平台管理员"按钮
3. 填写以下信息：
   - **用户名**：系统管理员的用户名
   - **手机号**：系统管理员的手机号（全局唯一，用作登录账号）
   - **密码**：系统管理员的密码（至少6个字符）
4. 点击"创建"按钮完成初始化

**注意**：系统管理员账号创建后，初始化按钮将不再显示。

#### 2. 登录系统

1. 在登录页面输入：
   - **手机号**：您的手机号
   - **密码**：您的密码
2. 点击"登录"按钮
3. 系统会自动识别您的身份（系统管理员或租户用户）
4. 登录成功后，系统会根据您的权限自动跳转到相应页面

## 系统管理员使用指南

### 租户管理

#### 创建租户

1. 登录系统后，进入"租户管理"页面
2. 点击"新建租户"按钮
3. 填写租户信息：
   - **租户编码**：租户的唯一编码（必填，不能重复）
   - **租户名称**：租户的名称（必填，不能重复）
   - **租户描述**：租户的描述信息（可选）
4. 点击"创建"按钮完成创建

**说明**：
- 创建租户时，系统会自动创建"租户管理员"角色
- 租户创建后，状态默认为"启用"

#### 管理租户

- **查看租户列表**：在租户管理页面可以查看所有租户
- **查看租户详情**：点击租户名称可以查看租户详情
- **编辑租户**：点击"编辑"按钮可以修改租户信息
- **启用/停用租户**：点击"启用"或"停用"按钮可以切换租户状态
- **删除租户**：点击"删除"按钮可以删除租户（需确认）

### 用户管理

#### 创建用户

1. 进入"用户管理"页面
2. 在租户下拉框中选择要创建用户的租户
3. 点击"新建用户"按钮
4. 填写用户信息：
   - **租户**：选择用户所属租户（必填）
   - **用户名**：用户的用户名（必填，租户内唯一）
   - **手机号**：用户的手机号（必填，全局唯一，用作登录账号）
   - **密码**：用户的密码（必填，至少6个字符）
   - **状态**：用户状态（启用/冻结）
5. 点击"创建"按钮完成创建

#### 管理用户

- **查看用户列表**：在用户管理页面可以查看选定租户的所有用户
- **查看用户详情**：点击用户名可以查看用户详情
- **编辑用户**：点击"编辑"按钮可以修改用户信息
- **启用/冻结用户**：点击"启用"或"冻结"按钮可以切换用户状态
- **删除用户**：点击"删除"按钮可以删除用户（需确认）
- **邀请用户**：点击"邀请用户"按钮可以生成邀请链接（占位实现）
- **批量导入**：点击"批量导入"按钮可以批量导入用户（占位实现）
- **锁定/解锁用户**：可以手动锁定或解锁用户账户（占位实现）

### 角色管理

#### 创建角色

1. 进入"角色管理"页面
2. 点击"新建角色"按钮
3. 填写角色信息：
   - **租户**：选择角色所属租户（系统管理员可以创建系统级角色，选择"无"）
   - **角色名称**：角色的名称（必填，租户内唯一）
   - **角色描述**：角色的描述信息（可选）
   - **状态**：角色状态（启用/停用）
4. 点击"创建"按钮完成创建

#### 管理角色

- **查看角色列表**：在角色管理页面可以查看所有角色
- **查看角色详情**：点击角色名称可以查看角色详情
- **编辑角色**：点击"编辑"按钮可以修改角色信息
- **启用/停用角色**：点击"启用"或"停用"按钮可以切换角色状态
- **删除角色**：点击"删除"按钮可以删除角色（需确认）
- **分配权限**：点击"分配权限"按钮可以为角色分配权限
- **分配用户**：点击"分配用户"按钮可以为角色分配用户

### 权限管理

#### 查看权限

1. 进入"权限管理"页面
2. 可以查看所有权限列表
3. 权限信息包括：
   - 权限编码
   - 权限名称
   - 权限描述
   - 权限类型（菜单/接口/按钮）
   - 所属模块
   - 所属租户（系统级权限显示"无"）

**说明**：权限由系统自动初始化，通常不需要手动创建。

### 配置管理

#### 查看和配置系统设置

1. 进入"配置管理"页面
2. 可以查看和配置以下类型的配置：
   - **模型相关**：LLM、Rerank、Embedding 配置
   - **存储相关**：向量库配置
   - **文档相关**：文档上传、文本切分策略配置
   - **问答相关**：检索参数配置
   - **系统相关**：Langfuse 配置
3. 配置说明：
   - 租户管理员可以看到系统级配置的默认值（作为初始值显示）
   - 修改配置后，会成为租户级配置，覆盖系统级默认值
   - 如果清空配置项，系统会删除租户级配置，回退到系统级默认值
   - 敏感字段（如 API Key）会自动加密存储，显示时仅显示首尾各 4 位

#### 配置可用性探测（占位）

系统提供了配置可用性探测功能（占位实现），可以测试配置是否可用。

**注意**：此功能为占位实现，实际功能待完善。

### 审计日志

#### 查看审计日志

1. 进入"审计日志"页面
2. 可以查看所有 API 请求和响应的记录
3. 支持按以下条件过滤：
   - 时间范围
   - 请求方法
   - 请求路径
   - 用户
   - 租户（仅系统管理员可见）
4. 可以查看详细的日志信息，包括：
   - 请求和响应内容（敏感数据已脱敏）
   - 性能指标（耗时、请求大小、响应大小）
   - 客户端信息（IP 地址、User-Agent）

**说明**：
- 所有 API 请求都会自动记录到审计日志
- 敏感数据会自动脱敏处理
- 如果启用了 Langfuse，请求也会同步记录到 Langfuse

## 租户管理员使用指南

### 用户管理

租户管理员可以管理本租户内的用户，操作方式与系统管理员相同，但只能操作本租户的用户。

**限制**：
- 不能选择其他租户
- 创建用户时，租户字段自动填充且不可修改
- 只能查看和操作本租户的用户

### 角色管理

租户管理员可以管理本租户内的角色，操作方式与系统管理员相同，但只能创建租户级角色。

**限制**：
- 不能创建系统级角色（tenant_id 为 None 的角色）
- 只能查看和操作本租户的角色
- 可以为角色分配系统级权限和本租户的权限

### 权限管理

租户管理员可以查看所有权限（系统级权限和租户级权限），但不能创建或修改权限。

### 配置管理

租户管理员可以管理本租户的配置，操作方式与系统管理员相同，但只能配置租户级配置。

**特点**：
- 可以看到系统级配置的默认值（作为初始值显示）
- 修改后成为租户级配置
- 清空配置项会回退到系统级默认值

### 审计日志

租户管理员可以查看本租户的审计日志，但不能查看其他租户的日志。

## 普通用户使用指南

普通用户根据分配的角色获得相应权限，通常用于：
- 文档管理（待开发）
- 智能问答（待开发）
- 其他业务功能

## 常见问题

### Q1: 忘记密码怎么办？

系统提供了密码重置功能（占位实现），您可以通过以下方式重置密码：

1. 在登录页面点击"忘记密码"
2. 输入您的手机号
3. 系统会发送验证码（占位实现，实际需要集成短信/邮件服务）
4. 输入验证码和新密码完成重置

**注意**：密码重置功能目前为占位实现，实际功能待完善。如果无法使用，请联系系统管理员或租户管理员重置密码。

### Q2: 如何切换租户？

系统管理员可以在用户管理页面选择不同的租户进行管理。租户管理员只能管理自己所属的租户。

### Q3: 如何为用户分配角色？

1. 进入"角色管理"页面
2. 找到要分配的角色，点击"分配用户"按钮
3. 在弹窗中选择要分配的用户
4. 点击"确定"完成分配

### Q4: 如何为角色分配权限？

1. 进入"角色管理"页面
2. 找到要分配权限的角色，点击"分配权限"按钮
3. 在弹窗中选择要分配的权限
4. 点击"确定"完成分配

### Q5: 系统管理员和租户管理员有什么区别？

- **系统管理员**：
  - 可以管理所有租户
  - 可以为任意租户创建用户
  - 可以创建系统级角色
  - 不归属于任何租户

- **租户管理员**：
  - 只能管理本租户
  - 只能为本租户创建用户
  - 只能创建租户级角色
  - 归属于特定租户

### Q6: 登录后没有看到某些菜单？

菜单的显示是根据您的权限动态控制的。如果您看不到某个菜单，说明您没有相应的菜单权限。请联系系统管理员或租户管理员为您分配相应的角色和权限。

### Q7: 如何启用 MFA（多因素认证）？

系统提供了 MFA 功能（占位实现），您可以通过以下方式启用：

1. 登录系统后，进入个人设置
2. 找到"多因素认证"选项
3. 点击"启用 MFA"
4. 系统会生成一个密钥和二维码
5. 使用认证应用（如 Google Authenticator）扫描二维码
6. 输入验证码完成启用

**注意**：MFA 功能目前为占位实现，实际功能待完善。

### Q8: 如何查看审计日志？

系统管理员和租户管理员可以查看审计日志：

1. 进入"审计日志"页面
2. 可以查看所有 API 请求和响应的记录
3. 支持按时间、用户、方法、路径等条件过滤
4. 点击"详情"可以查看完整的日志信息

**说明**：审计日志会自动记录所有 API 请求，包括敏感数据的脱敏版本。

### Q9: 什么是 Langfuse 集成？

Langfuse 是一个 LLM 应用观测和评估平台。如果系统管理员在配置管理中启用了 Langfuse，所有 API 请求会自动记录到 Langfuse，便于分析和优化。

**配置方式**：
1. 系统管理员进入"配置管理"页面
2. 找到"Langfuse"配置项
3. 启用 Langfuse，并配置 Public Key、Secret Key 和服务器地址
4. 配置生效后，所有 API 请求会自动记录到 Langfuse

## 注意事项

1. **手机号唯一性**：手机号在整个系统中必须唯一，不能重复使用
2. **用户名唯一性**：用户名在同一租户内必须唯一
3. **租户编码唯一性**：租户编码在整个系统中必须唯一
4. **租户名称唯一性**：租户名称在整个系统中必须唯一
5. **角色删除**：删除角色前，请确保没有用户使用该角色
6. **租户删除**：删除租户前，请确保租户内没有用户
7. **占位功能**：部分功能标记为"占位实现"，这些功能提供了基本框架，但实际功能待完善
8. **敏感数据保护**：配置中的敏感字段（如 API Key）会自动加密存储，显示时仅显示首尾各 4 位
9. **审计日志**：所有操作都会自动记录到审计日志，请谨慎操作
10. **配置管理**：租户管理员修改配置后，会成为租户级配置；清空配置会回退到系统级默认值

## 技术支持

如有问题，请联系系统管理员或查看系统日志。
