# 功能文档

## 系统概述

智能文档问答系统是一个基于多租户架构的个人知识库系统，支持文档管理、智能问答等功能。系统采用 RBAC（基于角色的访问控制）权限模型，支持系统管理员、租户管理员和普通用户三种角色。

## 核心功能模块

### 1. 认证与授权

#### 1.1 用户登录
- **功能描述**：用户通过手机号和密码登录系统
- **特点**：
  - 手机号全局唯一，系统自动识别用户所属租户
  - 支持系统管理员和租户用户统一登录入口
  - 使用 JWT Token 进行身份认证
  - 登录后根据用户权限自动跳转到相应页面

#### 1.2 权限管理
- **权限模型**：基于角色的访问控制（RBAC）
- **权限类型**：
  - 菜单权限：控制前端菜单显示
  - 接口权限：控制后端 API 访问
  - 按钮权限：控制前端按钮显示
- **权限命名规范**：`module:resource:action` 格式
  - 例如：`system:user:create`、`system:role:read`

### 2. 租户管理

#### 2.1 租户创建
- **功能描述**：系统管理员可以创建新租户
- **租户信息**：
  - 租户编码（唯一）
  - 租户名称（唯一）
  - 租户描述
  - 租户状态（启用/停用）
- **自动初始化**：
  - 创建租户时自动创建"租户管理员"角色
  - 为租户管理员角色分配默认权限

#### 2.2 租户管理
- **功能列表**：
  - 查看租户列表
  - 查看租户详情
  - 更新租户信息
  - 启用/停用租户
  - 删除租户

### 3. 用户管理

#### 3.1 用户创建
- **功能描述**：系统管理员和租户管理员可以创建用户
- **用户信息**：
  - 用户名（租户内唯一）
  - 手机号（全局唯一，用作登录账号）
  - 密码
  - 所属租户
  - 用户状态（启用/冻结）
- **权限控制**：
  - 系统管理员：可以为任意租户创建用户
  - 租户管理员：只能为本租户创建用户

#### 3.2 用户管理
- **功能列表**：
  - 查看用户列表（按租户筛选）
  - 查看用户详情
  - 更新用户信息
  - 启用/冻结用户
  - 删除用户
  - 为用户分配角色

### 4. 角色管理

#### 4.1 角色类型
- **系统级角色**：
  - 系统管理员：管理整个系统，可以创建租户、管理所有租户的用户
  - 租户管理员：管理租户内的用户、角色、权限
- **租户级角色**：由租户管理员创建，用于分配给租户内的用户

#### 4.2 角色管理
- **功能列表**：
  - 创建角色
  - 查看角色列表
  - 查看角色详情
  - 更新角色信息
  - 启用/停用角色
  - 删除角色
  - 为角色分配权限
  - 为角色分配用户

### 5. 权限管理

#### 5.1 权限类型
- **系统级权限**：系统管理员使用的权限，如租户管理相关权限
- **租户级权限**：租户管理员和普通用户使用的权限，如用户管理、角色管理、权限管理

#### 5.2 权限管理
- **功能列表**：
  - 查看权限列表
  - 查看权限详情
  - 权限自动初始化：系统启动时自动创建默认权限

### 6. 系统初始化

#### 6.1 系统管理员初始化
- **功能描述**：首次启动系统时，需要初始化系统管理员账号
- **初始化信息**：
  - 用户名
  - 手机号（全局唯一）
  - 密码
- **自动分配**：系统管理员创建后自动分配"系统管理员"角色

#### 6.2 默认数据初始化
- **自动初始化**：
  - 默认权限：系统启动时自动创建所有默认权限
  - 默认角色：自动创建"系统管理员"和"租户管理员"角色
  - 角色权限分配：自动为默认角色分配相应权限

## 用户角色说明

### 系统管理员
- **权限范围**：
  - 管理所有租户（创建、查看、更新、删除、启用/停用）
  - 为任意租户创建用户
  - 创建系统级角色和租户级角色
  - 管理所有权限
- **特点**：
  - 系统只有一个系统管理员账号
  - 不归属于任何租户（tenant_id 为空）
  - 通过"系统管理员"角色判断身份

### 租户管理员
- **权限范围**：
  - 管理本租户内的用户（创建、查看、更新、删除、启用/冻结）
  - 管理本租户内的角色（创建、查看、更新、删除）
  - 查看和管理权限
  - 为用户分配角色
- **特点**：
  - 归属于特定租户
  - 通过"租户管理员"角色判断身份
  - 不能管理其他租户的数据

### 普通用户
- **权限范围**：
  - 根据分配的角色获得相应权限
  - 通常用于文档管理和问答功能
- **特点**：
  - 归属于特定租户
  - 通过角色获得权限

## 数据隔离

### 租户隔离
- **强制隔离**：所有数据查询都强制带上 `tenant_id` 条件
- **隔离范围**：
  - 用户数据：租户管理员只能查看本租户的用户
  - 角色数据：租户管理员只能查看本租户的角色
  - 权限数据：租户管理员可以查看系统级权限和本租户的权限

### 系统级资源
- **系统级角色**：`tenant_id` 为 `None`，所有租户都可以使用
- **系统级权限**：`tenant_id` 为 `None`，所有租户都可以使用

## 技术特性

### 安全性
- **密码加密**：使用 bcrypt 加密存储密码
- **JWT Token**：使用 JWT 进行身份认证
- **权限校验**：所有 API 接口都进行权限校验
- **数据隔离**：严格的租户数据隔离

### 可扩展性
- **多租户架构**：支持多租户数据隔离
- **RBAC 权限模型**：灵活的权限管理
- **角色继承**：支持通过角色分配权限

### 用户体验
- **统一登录**：手机号登录，自动识别租户
- **权限驱动**：菜单和按钮根据权限动态显示
- **智能跳转**：登录后根据权限自动跳转到相应页面

## 待开发功能

### 文档管理模块
- 文档上传与解析
- 文档版本管理
- 文档标签管理
- 文档搜索

### 问答模块
- 智能问答
- 多轮对话
- 知识库检索
- 对话历史管理

### 配置管理模块
- AI 模型配置
- 向量库配置
- 文本切分策略配置
- 配置分层管理（系统/租户/用户）
